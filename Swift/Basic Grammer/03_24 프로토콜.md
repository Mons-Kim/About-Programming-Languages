# 프로토콜

---

- Java, C#의 인터페이스와 유사한 개념

- 형식이 공통적으로 구현해야 할 기능 목록을 정의하는 것으로 프로토콜 선언에는 메소드와 속성의 선언만 포함

- Objective-C의 프로토콜은 프로토콜을 채용한 클래스가 공통적으로 구현해야 할 메소드 목록을 선언하지만, Swift는 프로토콜을 채용한 클래스, 구조체, 열거형이 공통적으로 구현해야 할 메소드와 속성 목록을 선언할 수 있음

- 프로토콜을 채용한 형식에서 반드시 구현해야 하는 필수 요소와 선택적으로 구현할 수 있는 옵션 요소를 구분하여 선언 가능

- 설명용 예제 선언

  - 미디어 재생 기능(MediaPlayable)과 리모컨 조작 기능(RemoteControllable)을 프로토콜로 선언, 이 프로토콜을 채용하는 TV 클래스를 구현함
  - RemoteControllable 프로토콜이 MediaPlayable 프로토콜을 상속하도록 선언
  - MediaPlayable
    - 재생
    - 일시중지
    - 정지
    - 다음 트랙 <선택적 기능>
    - 이전 트랙 <선택적 기능>
  - RemoteControllable
    - 전원 On
    - 전원 Off
    - 음량 조절
    - 이전 채널 <선택적 기능>
    - 다음 채널 <선택적 기능>

  ```swift
  class Device: NSObject {
    	var modelName: String
    
    	init(name: String) {
        	modelName = name
      }
  }
  ```

- 프로토콜은 protocol 키워드로 선언. 프로토콜 내부에는 속성, 메소드, 생성자 선언 목록이 올 수 있음

  ```swift
  protocol (프로토콜 이름) {
    	(속성 선언 목록)
    	(메소드 선언 목록)
    	(생성자 선언 목록)
  }
  ```

- 프로토콜은 다른 프로토콜로부터 선언을 상속할 수 있고, 클래스와 달리 다중 상속을 허용하므로 여러 프로토콜의 상속 가능. 상속 문법은 클래스의 상속 문법과 공일

  ```swift
  protocol (프로토콜 이름): (상속할 프로토콜 이름1), ... , (상속할 프로토콜 이름N) {
    	// ...
  }
  ```

- 프로토콜 선언에 표함된 요소들은 기본적으로 필수 요소임. 선택적 요소로 선언하려면 optional 키워드를 선언 앞에 추가

- 프로토콜 선언과 요소의 선언 앞에 @objc 속성을 추가하면 이 프로토콜을 채용할 수 있는 대상은 Objective-C클래스로부터 상속된 클래스 또는 @objc 속성으로 선언된 클래스로 제한됨

  ```swift
  @objc protocol (프로토콜 이름) {
    	@objc optional (속성 선언)
    	@objc optional (메소드 선언)
  }
  ```

- MediaPlayable, RemoteControllable 프로토콜 선언

  ```swift
  @objc protocol MediaPlayable {
    	func play()
    	func pause()
    	func stop()
    	
    	@objc optional func nextMedia()
    	@objc optional func prevMedia()
  }
  
  @objc protocol RemoteControllable: MediaPlayable {
    	func on()
    	func off()
    	func volumeUp()
    	func volumeDown()
    
    	@objc optional func nextChannel()
    	@objc optional func prevChannel()
  }



#### 0.1 프로토콜 속성 선언

- 속성을 선언할 때는 (속성 이름)과 (자료형), 속성의 (읽기/ 쓰기 특성)을 지정해야 함

- 속성은 반드시 var로 선언해야 하며, 형식 속성을 선언하려면 static 키워드를 선언 앞부분에 추가

- (읽기/쓰기 특성)은 get, set 키워드로 지정

  ```swift
  static var (속성 이름): (자료형) { (읽기/쓰기 특성) }
  var (속성 이름): (자료형) { (읽기/쓰기 특성) }
  ```

  ```swift
  @objc protocol RemoteContrllable: MediaPlayable {
    	static var firmwareVersion: String { get }		// 형식 속성
    	var isOn: Bool { get set }			// 인스턴스 속성
  }
  ```



#### 0.2 프로토콜 메소드 선언

- 메소드 선언은 (메소드 이름), (파라미터 목록), (리턴형)으로 구성

- 메소드 구현에서 {}와 함수의 본문이 빠진 형태

- 형식 메소드를 선언하려면 static 키워드를 추가

- (파라미터 목록), (리턴형)은 필요에 따라 생략 가능

- 메소드 구현과 달리 파라미터에 기본값 지정 불가

  ```swift
  static func 메소드_이름(파라미터 목록) -> 리턴형
  func 메소드_이름(파라미터 목록) -> 리턴형
  ```

- 프로토콜에 포함된 메소드가 형식의 속성을 변경할 가능성이 있고, 값 형식이 프로토콜을 채용한다면 메소드 선언에 mutating 키워드를 추가해야 함

  ```swift
  mutating func 메소드_이름(파라미터 목록) -> 리턴형
  ```

  

#### 0.3 프로토콜 생성자 선언

- 프로토콜을 채용한 형식이 공통적으로 제공해야 할 생성자의 선언 가능

  ```swift
  init(파라미터 목록)
  init!(파라미터 목록)
  init?(파라미터 목록)
  ```

- 프로토콜에 생성자가 포함된 경우 이 프로토콜을 채용한 클래스는 생성자 선언 앞에 required 키워드를 추가해야 함. 단, 클래스가 final로 선언된 경우 생략 가능

- 하위 클래스에서 생성자를 재정의하는 경우에는 생성자 선언 앞에 required 키워드와 override 키워드를 모두 추가해야 함



### 1. 프로토콜 채용

---

- 프로토콜을 채용하는 형식은 선언부에 자신이 채용하는 프로토콜 목록을 명시해야 함.

- 클래스의 경우 상위 클래스의 이름이 항상 프로토콜 이름 목록 앞에 와야 함

  ```swift
  class 클래스_이름: 상위클래스_이름, 프로토콜_이름_목록 {
    	// ...
  }
  
  struct 구조체_이름: 프로토콜_이름_목록 {
    	// ...
  }
  
  enum 열거형_이름: 프로토콜_이름_목록 {
    	// ...
  }
  ```

- ex. DVDPlayer

  ```swift
  @objc class DVDPlayer: Device, MediaPlayable, RemoteControllable {
    	static var firmwareVersion: String = "1.0"
    	var isOn: Bool = false
    
      func play() {
          print("DVDPlayer.\(#function)")
      }
    
      func pause() {
          print("DVDPlayer.\(#function)")
      }
    
      func stop() {
          print("DVDPlayer.\(#function)")
      }
    
      func on() {
          print("DVDPlayer.\(#function)")
      }
    
      func off() {
          print("DVDPlayer.\(#function)")
      }
    
      func volumeUp() {
          print("DVDPlayer.\(#function)")
      }
    
      func volumeDown() {
          print("DVDPlayer.\(#function)")
      }
    
      func eject() {
          print("DVDPlayer.\(#function)")
      }
  }
  ```

  - 미디어 재생 기능, 리모컨 조작 기능 모두 제공
  - 채널 이동 기능과 미디어 이동 기능은 지원 안함
  - Device 클래스가 NSObject를 상속하고, MediaPlayable, RemoteControllable 프로토콜의 선택적 메소드가 @objc 속성으로 선언되었기 때문에 DVDPlayer 클래스는 @objc 속성으로 선언해야 함

  ```swift
  @objc class DVDPlayer: Device, MediaPlayable, RemoteControllable {
    	static var firmwareVersion: String {
        	return "1.0"
      }
    
    	var isOn: Bool {
        	get {
            	return self.isOn
          }
        	set {
            	self.isOn = newValue
          }
      }
    	// ...
  }
  ```

  - 프로토콜에서 선언한 속성은 해당 프로토콜을 채용하는 형식에서 반드시 선언해야 함
  - 속성의 이름과 자료형이 일치한다면 저장 속성과 계산 속성 중 하나로 구현 가능
  - 앞에서 저장 속성으로 선언한 속성을 계산 속성으로 바꾸어도 문제 없음

  ```swift
  @objc class DVDPlayer: Device, MediaPlayable, RemoteControllable {
    	// ...
    	var isOn: Bool { 	// Error
        	return self.isOn
      }
    	// ...
  }
  ```

  - 프로토콜에서 읽기 전용 속성으로 선언되어 있는 속성은 클래스에서 읽기/쓰기 속성으로 선언 가능. 
  - 읽기/쓰기 속성은 읽기 전용 속성이나 상수로 선언 불가

- ex. MP3Player

  ```swift
  @objc class MP3Player: Device, MediaPlayable {
    	func play() {
         print("MP3Player.\(#function)")
      }
    
    	func pause() {
         print("MP3Player.\(#function)")
      }
    
    	func stop() {
         print("MP3Player.\(#function)")
      }
    
    	func nextMedia() {
         print("MP3Player.\(#function)")
      }
    
    	func prevMedia() {
         print("MP3Player.\(#function)")
      }
  }
  ```

  - 미디어 재생 기능은 지원하지만 리모컨 조작 기능은 지원 안함

- ex. SmartTV

  ```swift
  @objc class SmartTV: Device, RemoteControllable {
    	static var firmwareVersion: String = "1.0"
    	var isOn: Bool = false
    	var volume = 0
    
    	func play() {
        	print("SmartTV.\(#function)")
      }
    
    	func pause() {
        	print("SmartTV.\(#function)")
      }
    
    	func stop() {
        	print("SmartTV.\(#function)")
      }
    
    	func nextMedia() {
        	print("SmartTV.\(#function)")
      }
    
    	func prevMedia() {
        	print("SmartTV.\(#function)")
      }
    
    	func on() {
        	print("SmartTV.\(#function)")
      }
    
    	func off() {
        	print("SmartTV.\(#function)")
      }
    
    	func volumeUp() {
        	print("SmartTV.\(#function)")
        
        	volume = min(100, volume+1)
        	print("SmartTV: volume \(volume)")
      }
    
    	func volumeDown() {
        	print("SmartTV.\(#function)")
        
        	volume = max(0, volume-1)
        	print("SmartTV: volume \(volume)")
      }
    
    	func nextChannel() {
        	print("SmartTV.\(#function)")
      }
    
    	func prevChannel() {
        	print("SmartTV.\(#function)")
      }
  }
  ```

  - RemoteControllable 프로토콜이 MediaPlayable 프로토콜을 상속하고 있기 때문에 RemoteControllalbe만 선언해도 문제 없음



### 2. 프로토콜 형식

---





